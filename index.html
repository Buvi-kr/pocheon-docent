<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í¬ì²œì•„íŠ¸ë°¸ë¦¬ ì²œë¬¸ê³¼í•™ê´€ AI ë„ìŠ¨íŠ¸</title>
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; background: #000; color: white; font-family: 'Pretendard', sans-serif; overflow: hidden; }
        .background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at center, #1a237e 0%, #000000 80%); }
        .stars { position: absolute; width: 100%; height: 100%; background-image: url('https://cdn.pixabay.com/photo/2016/06/27/22/14/stars-1483324_960_720.png'); opacity: 0.4; z-index: -1; }

        /* --- [NEW] ì‹œì‘ í™”ë©´ (ì˜¤ë²„ë ˆì´) --- */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .start-btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #f44336, #ff9800);
            border: none;
            border-radius: 50px;
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.6);
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }

        /* --- í—¤ë” ì˜ì—­ (ì´ë¯¸ì§€ ë³€ê²½ë¨) --- */
        .header-area { flex: 0 0 auto; padding: 15px; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 15px; z-index: 10; }
        
        /* ìºë¦­í„° 3ë§ˆë¦¬ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .character-group-img { 
            width: 60px; height: 60px; 
            background: white; 
            border-radius: 50%; 
            border: 3px solid #4fc3f7; 
            object-fit: cover; /* ì´ë¯¸ì§€ê°€ ê½‰ ì°¨ê²Œ */
            display: block;
        }
        
        .header-text h1 { margin: 0; font-size: 1.1rem; color: #fff; text-shadow: 0 0 10px #4fc3f7; }
        .header-text p { margin: 0; font-size: 0.8rem; color: #ccc; }
        
        /* ì±„íŒ… ì˜ì—­ */
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
        .message { padding: 12px 16px; border-radius: 18px; max-width: 80%; line-height: 1.5; font-size: 0.95rem; word-break: break-word; animation: popIn 0.5s; }
        .user-msg { background: #3949ab; align-self: flex-end; border-bottom-right-radius: 4px; color: white; }
        .ai-msg { background: rgba(255,255,255,0.15); align-self: flex-start; border-bottom-left-radius: 4px; color: #e3f2fd; border: 1px solid rgba(255,255,255,0.1); }
        @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ëŸ¬ */
        .control-area { flex: 0 0 auto; padding: 10px 15px; padding-bottom: max(20px, env(safe-area-inset-bottom)); background: #121212; display: flex; align-items: center; gap: 10px; border-top: 1px solid #333; z-index: 20; }
        .input-box { flex: 1; background: #2c2c2c; border: 1px solid #444; border-radius: 25px; padding: 12px 15px; color: white; font-size: 1rem; outline: none; }
        .icon-btn { width: 45px; height: 45px; border-radius: 50%; border: none; color: white; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        #mic-btn { background: #f44336; }
        #mic-btn.listening { background: #4caf50; animation: pulse 1.5s infinite; }
        #send-btn { background: #3949ab; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); } }

    </style>
</head>
<body>
    <div class="background"></div>
    <div class="stars"></div>

    <div id="start-screen">
        <img src="https://cdn-icons-png.flaticon.com/512/3069/3069172.png" alt="ë§ˆìŠ¤ì½”íŠ¸ë“¤" style="width:150px; margin-bottom:20px;">
        <h2 style="color:white; margin:0;">ì²œë¬¸ê³¼í•™ê´€ AI ë„ìŠ¨íŠ¸</h2>
        <p style="color:#bbb;">ë˜ë¹„, ë„ê¸°, ìºí‹°ì™€ í•¨ê»˜ ë– ë‚˜ëŠ” ìš°ì£¼ ì—¬í–‰!</p>
        <button class="start-btn" onclick="startExperience()">ì…ì¥í•˜ê¸° ğŸš€</button>
    </div>

    <div class="header-area">
        <img src="https://cdn-icons-png.flaticon.com/512/3069/3069172.png" class="character-group-img" id="header-img">
        <div class="header-text">
            <h1 id="exhibit-name">ë˜ë¹„, ë„ê¸°, ìºí‹°</h1>
            <p id="status-text">ëŒ€ê¸° ì¤‘</p>
        </div>
    </div>

    <div class="chat-area" id="chat-box">
        </div>

    <div class="control-area">
        <button class="icon-btn" id="mic-btn">ğŸ™ï¸</button>
        <input type="text" class="input-box" id="text-input" placeholder="ê¶ê¸ˆí•œ ê±¸ ë¬¼ì–´ë´!" autocomplete="off">
        <button class="icon-btn" id="send-btn">â¤</button>
    </div>

    <script>
        // --- 1. ì „ì‹œë¬¼ ë°ì´í„° (3ì¸ì¡° ë§ˆìŠ¤ì½”íŠ¸ ë°˜ì˜) ---
        const exhibits = {
            'default': { 
                name: 'ë˜ë¹„, ë„ê¸°, ìºí‹°', 
                // [TIP] ì•„ë˜ promptë¥¼ ìˆ˜ì •í•´ì„œ ìºë¦­í„°ë“¤ì˜ ë§íˆ¬ë¥¼ ë” ìì„¸íˆ ì„¤ì •í•˜ì„¸ìš”.
                prompt: `
                    ë„ˆëŠ” í¬ì²œì•„íŠ¸ë°¸ë¦¬ ì²œë¬¸ê³¼í•™ê´€ì˜ ë§ˆìŠ¤ì½”íŠ¸ 3ì¸ì¡° 'ë˜ë¹„, ë„ê¸°, ìºí‹°'ì•¼.
                    ì‚¬ìš©ìê°€ ë„ˆí¬ì™€ í•¨ê»˜ ì „ì‹œê´€ì„ ë‘˜ëŸ¬ë³´ëŠ” ìƒí™©ì´ì•¼.
                    
                    [ì„±ê²© ì„¤ì •]
                    - ë˜ë¹„(í† ë¼): í˜¸ê¸°ì‹¬ì´ ë§ê³  ì§ˆë¬¸ì„ ì¢‹ì•„í•¨.
                    - ë„ê¸°(ê°•ì•„ì§€): ì”©ì”©í•˜ê³  ìš©ê°í•¨.
                    - ìºí‹°(ê³ ì–‘ì´): ë˜‘ë˜‘í•˜ê³  ì°¨ë¶„í•˜ê²Œ ì„¤ëª…í•´ì¤Œ.
                    
                    [ë§íˆ¬]
                    - ì„¸ ì¹œêµ¬ê°€ ë²ˆê°ˆì•„ê°€ë©° ë§í•˜ëŠ” ê²ƒì²˜ëŸ¼ í’ì„±í•˜ê²Œ ëŒ€ë‹µí•´ì¤˜.
                    - "ìš°ë¦¬ê°€ ì•Œë ¤ì¤„ê²Œ!", "ê°™ì´ ê°€ë³´ì!" ì²˜ëŸ¼ 'ìš°ë¦¬'ë¼ëŠ” í‘œí˜„ì„ ì¨.
                    - ì¹œê·¼í•œ ë°˜ë§(~í•´, ~ì•¼)ì„ ì‚¬ìš©í•´.
                    - ì´ëª¨ì§€ë¥¼ ë§ì´ ì¨ì„œ(ğŸ°ğŸ¶ğŸ±) ê·€ì—½ê²Œ í‘œí˜„í•´.
                ` 
            }
        };

        const currentData = exhibits['default'];

        // --- [NEW] 2. ì…ì¥ ë° ìë™ ì¸ì‚¬ ë¡œì§ ---
        function startExperience() {
            // ì‹œì‘ í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById('start-screen').style.display = 'none';

            // â˜… ì²« ì¸ì‚¬ ë©˜íŠ¸ ì„¤ì • â˜…
            const openingMent = "ì•ˆë…•! ìš°ë¦¬ëŠ” í¬ì²œì•„íŠ¸ë°¸ë¦¬ ì²œë¬¸ê³¼í•™ê´€ì˜ ë§ˆìŠ¤ì½”íŠ¸ ë˜ë¹„, ë„ê¸°, ìºí‹°ì•¼! ğŸ°ğŸ¶ğŸ±\n\nì˜¤ëŠ˜ ë„ˆì˜ ì¼ì¼ ë„ìŠ¨íŠ¸ê°€ ë˜ì–´ ì „ì‹œê´€ì„ ê°™ì´ ë‘˜ëŸ¬ë³¼ê²Œ. ì¤€ë¹„ëë‹ˆ?";
            
            // í™”ë©´ì— ë„ìš°ê¸°
            addMessage(openingMent, 'ai');
            
            // ë§í•˜ê¸° (ì†Œë¦¬)
            speak(openingMent);
        }

        // --- 3. ì±„íŒ… UI ---
        const chatBox = document.getElementById('chat-box');
        const statusText = document.getElementById('status-text');

        function addMessage(text, type) {
            const div = document.createElement('div');
            div.className = `message ${type === 'user' ? 'user-msg' : 'ai-msg'}`;
            div.innerText = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function handleUserInput(text) {
            if (!text.trim()) return;

            addMessage(text, 'user');
            statusText.innerText = "ìƒê°í•˜ëŠ” ì¤‘...";

            const reply = await callGeminiAPI(text);
            
            statusText.innerText = "ë‹µë³€ ì¤‘...";
            addMessage(reply, 'ai');
            speak(reply);
        }

        // --- 4. ì…ë ¥ ì²˜ë¦¬ ---
        const textInput = document.getElementById('text-input');
        const sendBtn = document.getElementById('send-btn');

        sendBtn.addEventListener('click', () => {
            const text = textInput.value;
            if (text) {
                handleUserInput(text);
                textInput.value = ''; 
            }
        });
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendBtn.click();
        });

        // --- 5. ìŒì„± ì¸ì‹ ---
        const micBtn = document.getElementById('mic-btn');
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if(SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.interimResults = false;

            micBtn.addEventListener('click', () => {
                window.speechSynthesis.cancel();
                micBtn.classList.add('listening');
                statusText.innerText = "ë“£ê³  ìˆì–´ìš”...";
                recognition.start();
            });

            recognition.onresult = (event) => {
                const voiceText = event.results[0][0].transcript;
                micBtn.classList.remove('listening');
                handleUserInput(voiceText);
            };
            recognition.onspeechend = () => micBtn.classList.remove('listening');
            recognition.onerror = () => micBtn.classList.remove('listening');
        } else {
            micBtn.style.display = 'none';
        }

        // --- 6. ë°±ì—”ë“œ í†µì‹  ---
        async function callGeminiAPI(text) {
            try {
                // gemini-2.5-flash-lite ëª¨ë¸ ì‚¬ìš© (api/chat.js ì„¤ì • ë”°ë¦„)
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: text,
                        systemPrompt: currentData.prompt 
                    })
                });
                const data = await response.json();
                return data.reply || "ì˜¤ë¥˜ê°€ ë‚¬ì–´ ã… ã…  ë‹¤ì‹œ ë§í•´ì¤„ë˜?";
            } catch (err) {
                return "ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì¤˜!";
            }
        }

        // --- 7. TTS ---
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 1.0;
            window.speechSynthesis.speak(utterance);
            utterance.onend = () => statusText.innerText = "ëŒ€ê¸° ì¤‘";
        }
    </script>
</body>
</html>
