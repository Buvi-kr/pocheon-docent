<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í¬ì²œì•„íŠ¸ë°¸ë¦¬ ì²œë¬¸ê³¼í•™ê´€ AI ë„ìŠ¨íŠ¸</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ìš°ì£¼ í…Œë§ˆ */
        body { margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: space-between; height: 100vh; background: #000; color: white; font-family: 'Pretendard', sans-serif; overflow: hidden; }
        .background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at center, #1a237e 0%, #000000 70%); }
        .stars { position: absolute; width: 100%; height: 100%; background-image: url('https://cdn.pixabay.com/photo/2016/06/27/22/14/stars-1483324_960_720.png'); opacity: 0.5; z-index: -1; }

        /* ì „ì‹œë¬¼ ì •ë³´ ì˜ì—­ */
        .info-area { text-align: center; margin-top: 50px; padding: 20px; z-index: 10; }
        .character-img { width: 180px; height: 180px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 60px; border: 3px solid rgba(100, 181, 246, 0.5); backdrop-filter: blur(5px); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        
        h1 { margin: 0; font-size: 1.8rem; text-shadow: 0 0 10px #4fc3f7; }
        .subtitle { color: #b3e5fc; font-size: 0.9rem; margin-top: 5px; }

        /* ëŒ€í™” ìƒíƒœ í…ìŠ¤íŠ¸ */
        .status-box { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 80%; text-align: center; }
        #status-text { font-size: 1.1rem; color: #fff; margin-bottom: 15px; font-weight: bold; }
        #ai-response { font-size: 1rem; color: #ddd; line-height: 1.5; max-height: 200px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 10px; width: 100%; display: none; }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ëŸ¬ */
        .control-area { width: 100%; padding-bottom: 40px; display: flex; justify-content: center; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); }
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; border: none; background: #f44336; color: white; font-size: 32px; cursor: pointer; box-shadow: 0 0 20px rgba(244, 67, 54, 0.4); transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .mic-btn:active { transform: scale(0.9); }
        .mic-btn.listening { background: #4caf50; box-shadow: 0 0 30px #4caf50; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(76, 175, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); } }

    </style>
</head>
<body>
    <div class="background"></div>
    <div class="stars"></div>

    <div class="info-area">
        <div class="character-img" id="char-icon">ğŸ¤–</div>
        <h1 id="exhibit-name">ì „ì‹œë¬¼ ì°¾ëŠ” ì¤‘...</h1>
        <div class="subtitle">AI ë„ìŠ¨íŠ¸</div>
    </div>

    <div class="status-box">
        <div id="status-text">ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì§ˆë¬¸í•˜ì„¸ìš”</div>
        <div id="ai-response"></div>
    </div>

    <div class="control-area">
        <button class="mic-btn" id="mic-btn">ğŸ™ï¸</button>
    </div>

    <script>
        // --- 1. ì „ì‹œë¬¼ ë°ì´í„° (ì—¬ê¸°ì— ë‚´ìš©ì„ ê³„ì† ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤) ---
        const exhibits = {
            'jupiter': { name: 'ëª©ì„± (Jupiter)', icon: 'ğŸª', prompt: 'ë„ˆëŠ” íƒœì–‘ê³„ì˜ ì™•, ëª©ì„±ì´ë‹¤. ì•„ì£¼ ê±°ëŒ€í•˜ê³  ìœ„ì—„ ìˆì§€ë§Œ ì•„ì´ë“¤ì—ê²Œ ì¹œì ˆí•´. ëŒ€ì ì ì— ëŒ€í•´ ìë‘í•´ì¤˜.' },
            'apollo': { name: 'ì•„í´ë¡œ 11í˜¸', icon: 'ğŸš€', prompt: 'ë„ˆëŠ” ì¸ë¥˜ ìµœì´ˆë¡œ ë‹¬ì— ì°©ë¥™í•œ ì•„í´ë¡œ 11í˜¸ì•¼. ëª¨í—˜ì‹¬ì´ ê°•í•˜ê³  ìš©ê°í•œ ë§íˆ¬ë¥¼ ì¨.' },
            'default': { name: 'ì•ˆë‚´ ë°ìŠ¤í¬', icon: 'ğŸ’', prompt: 'ë„ˆëŠ” ì²œë¬¸ê³¼í•™ê´€ì˜ ì¹œì ˆí•œ ì•ˆë‚´ì› í¬ìš°ë¦¬ì•¼.' }
        };

        // URLì—ì„œ ID ê°€ì ¸ì˜¤ê¸°
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const currentData = exhibits[id] || exhibits['default'];

        // í™”ë©´ ì„¸íŒ…
        document.getElementById('exhibit-name').innerText = currentData.name;
        document.getElementById('char-icon').innerText = currentData.icon;

        // --- 2. ìŒì„± ì¸ì‹ & í•©ì„± ì„¤ì • ---
        const micBtn = document.getElementById('mic-btn');
        const statusText = document.getElementById('status-text');
        const aiResponseBox = document.getElementById('ai-response');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        if(SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.interimResults = false;
        } else {
            statusText.innerText = "ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (í¬ë¡¬ ê¶Œì¥)";
        }

        // --- 3. ë²„íŠ¼ ì´ë²¤íŠ¸ ---
        micBtn.addEventListener('click', () => {
            if (!recognition) return;
            
            // TTSê°€ ë§í•˜ê³  ìˆë‹¤ë©´ ë©ˆì¶¤
            window.speechSynthesis.cancel();

            micBtn.classList.add('listening');
            statusText.innerText = "ë“£ê³  ìˆì–´ìš”... ë§ì”€í•˜ì„¸ìš”!";
            aiResponseBox.style.display = 'none';
            recognition.start();
        });

        if(recognition) {
            recognition.onresult = async (event) => {
                const userMsg = event.results[0][0].transcript;
                micBtn.classList.remove('listening');
                statusText.innerText = "ìƒê°í•˜ëŠ” ì¤‘...";
                
                // ë°±ì—”ë“œë¡œ ì „ì†¡
                const reply = await callGeminiAPI(userMsg);
                
                // ë‹µë³€ ì¶œë ¥ ë° ì½ê¸°
                statusText.innerText = "ë‹µë³€í•˜ëŠ” ì¤‘...";
                aiResponseBox.innerText = reply;
                aiResponseBox.style.display = 'block';
                speak(reply);
            };

            recognition.onerror = () => {
                micBtn.classList.remove('listening');
                statusText.innerText = "ë‹¤ì‹œ ëˆŒëŸ¬ì„œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.";
            };
        }

        // --- 4. ë°±ì—”ë“œ í†µì‹  (Gemini í˜¸ì¶œ) ---
        async function callGeminiAPI(text) {
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: text,
                        systemPrompt: currentData.prompt 
                    })
                });
                const data = await response.json();
                return data.reply;
            } catch (err) {
                console.error(err);
                return "ì£„ì†¡í•´ìš”, ì—°ê²° ìƒíƒœê°€ ì¢‹ì§€ ì•Šì•„ìš”.";
            }
        }

        // --- 5. ìŒì„± í•©ì„± (TTS) ---
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 1.0;
            window.speechSynthesis.speak(utterance);
            
            utterance.onend = () => {
                statusText.innerText = "ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì§ˆë¬¸í•˜ì„¸ìš”";
            };
        }
    </script>
</body>
</html>