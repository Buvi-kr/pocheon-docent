<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Vercel Live2D Fix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; background-color: #1a1a1a; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: white; font-family: sans-serif; }
        canvas { display: block; }
        #status { 
            position: absolute; top: 20px; 
            background: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px;
            font-size: 14px; color: #fff; z-index: 100;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/6.5.2/browser/pixi.min.js"></script>
    
    <script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.min.js"></script>
</head>
<body>

    <div id="status">연결 초기화 중...</div>
    <canvas id="canvas"></canvas>

    <script>
        const statusEl = document.getElementById('status');
        
        // 모델 URL (히요리 - Cubism 4)
        const MODEL_URL = 'https://cdn.jsdelivr.net/gh/Live2D/CubismWebSamples@develop/Samples/Resources/Hiyori/Hiyori.model3.json';

        (async function () {
            // 1. 안전 장치: 라이브러리 로드 확인
            if (!window.PIXI) {
                statusEl.innerText = "❌ PixiJS 로드 실패";
                return;
            }
            // Cubism 4 전용 로더를 썼으므로 PIXI.live2d가 즉시 없을 수도 있음 (비동기 초기화 가능성 대비)
            // 하지만 script 태그 순서대로면 보통 바로 잡힙니다.

            // 2. Pixi App 생성
            const app = new PIXI.Application({
                view: document.getElementById('canvas'),
                autoStart: true,
                resizeTo: window,
                backgroundAlpha: 0
            });

            statusEl.innerText = "⏳ 모델 데이터 다운로드 중...";

            try {
                // 3. 모델 로드
                // cubism4.min.js를 썼기 때문에 Live2DModel이 아니라 'Live2DModel'이 PIXI.live2d 안에 있는지 확인 필요
                // 보통 플러그인이 로드되면 PIXI.live2d.Live2DModel 로 접근 가능합니다.
                
                if (!PIXI.live2d) {
                     throw new Error("플러그인 로드 지연됨. 새로고침 해주세요.");
                }

                const model = await PIXI.live2d.Live2DModel.from(MODEL_URL);

                // 4. 모델 배치
                model.anchor.set(0.5);
                model.x = window.innerWidth / 2;
                model.y = window.innerHeight / 2 + 100;
                model.scale.set(0.25);

                // 5. 인터랙션
                model.interactive = true;
                model.on('pointertap', () => {
                    model.motion('TapBody');
                    statusEl.innerText = "✨ 터치 반응 성공!";
                    setTimeout(() => statusEl.innerText = "준비 완료", 2000);
                });

                app.stage.addChild(model);
                
                statusEl.innerText = "✅ 로드 성공! (화면을 터치해보세요)";
                statusEl.style.color = "#4caf50";

            } catch (error) {
                console.error("Live2D Error:", error);
                statusEl.innerText = "❌ 오류 발생: " + error.message;
                statusEl.style.color = "#ff4444";
            }
        })();

        // 창 크기 조절 대응
        window.addEventListener('resize', () => {
             if (app && app.stage.children[0]) {
                 const m = app.stage.children[0];
                 m.x = window.innerWidth / 2;
                 m.y = window.innerHeight / 2 + 100;
             }
        });
    </script>
</body>
</html>
