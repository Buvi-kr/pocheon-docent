<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Live2D Cubism 2 Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://cdn.jsdelivr.net/gh/datsver/live2d-widget@latest/live2d.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/6.5.2/browser/pixi.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/index.min.js"></script>

    <style>
        body { margin: 0; background-color: #333; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: white; font-family: sans-serif; }
        #canvas-container { position: relative; width: 100vw; height: 100vh; }
        canvas { display: block; width: 100%; height: 100%; }
        
        .btn-area { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; background: #4fc3f7; font-weight: bold; }
        button:active { background: #039be5; color: white; }
    </style>
</head>
<body>

    <div id="canvas-container">
        <canvas id="canvas"></canvas>
        
        <div class="btn-area">
            <button onclick="testMotion()">ğŸ‘‹ ì¸ì‚¬í•˜ê¸°</button>
            <button onclick="testSpeak()">ğŸ’¬ ë§í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // [ì¤‘ìš”] Cubism 2 ëª¨ë¸ íŒŒì¼ (.model.json ìœ¼ë¡œ ëë‚¨)
        // ì‹œì¦ˆì¿ (Shizuku) - ê°€ì¥ ì•ˆì •ì ì¸ êµ­ë¯¼ ì˜ˆì œ ëª¨ë¸
        const MODEL_URL = 'https://cdn.jsdelivr.net/gh/guansss/pixi-live2d-display/test/assets/shizuku/shizuku.model.json';

        let app, model;

        async function init() {
            // Pixi Application ìƒì„±
            app = new PIXI.Application({
                view: document.getElementById('canvas'),
                autoStart: true,
                resizeTo: window,
                backgroundAlpha: 0
            });

            console.log("ëª¨ë¸ ë¡œë”© ì‹œì‘...");

            // ëª¨ë¸ ë¡œë“œ
            model = await PIXI.live2d.Live2DModel.from(MODEL_URL);

            // ìœ„ì¹˜ ì¡ê¸°
            model.anchor.set(0.5);
            model.x = window.innerWidth / 2;
            model.y = window.innerHeight / 2 + 50;
            model.scale.set(0.3); // ì‹œì¦ˆì¿ ëŠ” ì»¤ì„œ ì¢€ ì¤„ì—¬ì•¼ í•¨

            // ìƒí˜¸ì‘ìš© ì„¤ì •
            model.interactive = true;
            model.on('pointertap', () => {
                model.motion('tap_body'); // ì‹œì¦ˆì¿  ëª¨ë¸ì˜ ëª¨ì…˜ ì´ë¦„
            });

            app.stage.addChild(model);
            console.log("ëª¨ë¸ ë¡œë“œ ì™„ë£Œ!");
        }

        init();

        // ëª¨ì…˜ í…ŒìŠ¤íŠ¸ (ì‹œì¦ˆì¿  ì „ìš© ëª¨ì…˜ ì´ë¦„ ì‚¬ìš©)
        function testMotion() {
            if(model) {
                // ì‹œì¦ˆì¿ ê°€ ê°€ì§„ ëª¨ì…˜ ê·¸ë£¹ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ ì¬ìƒ
                model.motion('tap_body'); 
            }
        }

        // ë§í•˜ê¸° í…ŒìŠ¤íŠ¸
        function testSpeak() {
            const text = "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì‹œì¦ˆì¿ ì…ë‹ˆë‹¤.";
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "ko-KR";
            window.speechSynthesis.speak(utterance);

            // ì… ë²™ê¸‹ê±°ë¦¬ê¸°
            let interval = setInterval(() => {
                if(model) {
                    // Cubism 2ëŠ” íŒŒë¼ë¯¸í„° ì´ë¦„ì´ ì¡°ê¸ˆ ë‹¤ë¦„ (PARAM_MOUTH_OPEN_Y)
                    // í•˜ì§€ë§Œ í”ŒëŸ¬ê·¸ì¸ì´ ì•Œì•„ì„œ ë§¤í•‘í•´ì£¼ê¸°ë„ í•¨. ì•ˆì „í•˜ê²Œ ì§ì ‘ ì§€ì •.
                    try {
                        model.internalModel.coreModel.setParamFloat('PARAM_MOUTH_OPEN_Y', Math.random());
                    } catch(e) {}
                }
            }, 100);

            utterance.onend = () => {
                clearInterval(interval);
                if(model) {
                    try {
                        model.internalModel.coreModel.setParamFloat('PARAM_MOUTH_OPEN_Y', 0);
                    } catch(e) {}
                }
            };
        }

        window.onresize = () => {
            if (model) {
                model.x = window.innerWidth / 2;
                model.y = window.innerHeight / 2 + 50;
            }
        }
    </script>
</body>
</html>
